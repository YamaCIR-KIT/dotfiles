#!/bin/bash

rosdistro="kinetic"

[ -e /opt/ros/$rosdistro/setup.bash ] && source /opt/ros/$rosdistro/setup.bash

if test -e /var/tmp/mark/c
then
  if test -e $(cat /var/tmp/mark/c)/devel/setup.bash
  then
    source $(cat /var/tmp/mark/c)/devel/setup.bash
  fi

  if test -e $(cat /var/tmp/mark/c)/install/setup.bash
  then
    source $(cat /var/tmp/mark/c)/install/setup.bash
  fi

  rospack profile &> /dev/null
fi

alias cdc='cd $(cat /var/tmp/mark/c)'
alias cds='cd $(cat /var/tmp/mark/c)/src'

# make()
# {
#   if test -e $(pwd)/Makefile
#   then
#     command make $@
#   else
#     pushd $(cat /var/tmp/mark/c) && command catkin_make $@ && source devel/setup.bash
#     # rospack profile | sed -E "s/(.*)(\s\**\s)(.*)/\3/g" | grep -e "\/.*" | sort
#     rospack profile > /dev/null
#     popd
#   fi
# }

recursive_wstool_update()
{
  pushd $(cat /var/tmp/mark/c)
  wstool init src

  echo "hoge" > /tmp/wstool_outputs

  while test "$(cat /tmp/wstool_outputs)" != "Merge caused no change, no new elements found"
  do
    find -regextype posix-basic -regex "\./src/.*/.*\.rosinstall" | xargs -n1 wstool merge --target-workspace=src | uniq | tee /tmp/wstool_outputs
    wstool update --target-workspace=src
  done

  rm /tmp/wstool_outputs
  popd
}

function catkin_make_autoware()
{
  # CATKIN_OPTS="-DCMAKE_BUILD_TYPE=Release -DCMAKE_LIBRARY_PATH=/usr/local/cuda/lib64/stubs install"
  CATKIN_OPTS="-DCMAKE_BUILD_TYPE=Release install"

  export LIBRARY_PATH=/usr/lib/OpenNI2/Drivers:$LIBRARY_PATH
  catkin_make $CATKIN_OPTS $@
}

function colcon_make_autoware()
{
  # COLCON_OPTS="--cmake-args -DCMAKE_BUILD_TYPE=Release -DCMAKE_LIBRARY_PATH=/usr/local/cuda/lib64/stubs"
  COLCON_OPTS="--cmake-args -DCMAKE_BUILD_TYPE=Release"

  export LIBRARY_PATH=/usr/lib/OpenNI2/Drivers:$LIBRARY_PATH
  colcon build $COLCON_OPTS $@
}

